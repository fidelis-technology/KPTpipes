<?xml version="1.0" encoding="UTF-8" ?>
<odoo>
    <!-- Inherit Repair Order Form View -->
    <record id="inherit_view_repair_order_form" model="ir.ui.view">
        <field name="name">inherit.view.repair.order.form</field>
        <field name="model">repair.order</field>
        <field name="inherit_id" ref="repair.view_repair_order_form"/>
        <field name="arch" type="xml">
            <xpath expr="//field[@name='move_ids']/tree//field[@name='product_id']" position="after">
                <field name="product_qty_available" readable="True"/>
            </xpath>
            <xpath expr="//field[@name='partner_id']" position="replace">
                    <group>
                        <field name="partner_id" string="Customer"/>
                        <field name="user_id" invisible="1"/>
                    </group>
                    <group>
                        <field name="vehicle_name"/>
                        <field name="number_plate" readonly="1"/>
                        <field name="chassis_number" readonly="1"/>
                    </group>
                    <group>
                        <field name="driver_id"/>
                        <field name="driver_mobile" readonly="1"/>
                    </group>

                    <group>
                        <field name="time_in"/>
                        <field name="time_out"/>
                    </group>
            </xpath>
            <xpath expr="//field[@name='product_id']" position="attributes">
                <attribute name="invisible">1</attribute>
            </xpath>
            <xpath expr="//field[@name='product_qty']" position="attributes">
                <attribute name="invisible">1</attribute>
            </xpath>
            <xpath expr="//field[@name='picking_id']" position="attributes">
                <attribute name="invisible">1</attribute>
            </xpath>
             <xpath expr="//field[@name='move_ids']/tree//field[@name='product_id']" position="after">
                <field name="product_cost"/>
            </xpath>
            <xpath expr="//field[@name='move_ids']" position="after">
                <div style="float: right; margin-top: 5px; text-align: right;">
                    <h5>
                        <strong>Subtotal: <field name="subtotal" string="Subtotal" nolabel="1" force_save="1"/></strong>
                    </h5>
                    <h5>
                        <strong>Extra Cost: <field name="extra_cost" string="Extra" nolabel="1"/></strong>
                    </h5>
                    <h5>
                        <strong>Final Cost: <field name="final_cost" string="Final Cost" nolabel="1"/></strong>
                    </h5>
                </div>
            </xpath>
            <xpath expr="//div[@class='oe_button_box']" position="inside">
                <button name="action_view_extra_costs"
                        type="object"
                        class="oe_stat_button"
                        icon="fa-money">
                    <field name="extra_cost" widget="statinfo" string="Extra Costs"/>
                </button>
            </xpath>
            <xpath expr="//notebook/page[@name='parts']" position="before">
                <page name="problems" string="Problems">
                    <field name="problem_ids">
                        <tree editable="bottom">
                            <field name="sequence" widget="handle"/>
                            <field name="problem_id"/>
                            <field name="work_section_id"/>
                            <field name="employee_id" string="Attempted By"/>
                            <field name="status_id"/>
                            <field name="remarks"/>
                        </tree>
                    </field>
                </page>
            </xpath>

        </field>
    </record>

    <!-- Tree View for Listing Extra Costs -->
    <record id="view_repair_order_extra_cost_tree" model="ir.ui.view">
        <field name="name">repair.order.extra.cost.tree</field>
        <field name="model">repair.order.extra.cost</field>
        <field name="arch" type="xml">
            <tree string="Extra Costs" create="false">
                <field name="sequence" string="No."/>
                <field name="equipment_name"/>
                <field name="serial_number"/>
                <field name="workshop_id"/>
                <field name="repair_date"/>
                <field name="extra_price"/>
                <field name="supporting_documents" widget="many2many_binary" options="{'multi': True}"/>
            </tree>
        </field>
    </record>

    <!-- Form View for Extra Cost Details -->
    <record id="view_repair_order_extra_cost_form" model="ir.ui.view">
        <field name="name">repair.order.extra.cost.form</field>
        <field name="model">repair.order.extra.cost</field>
        <field name="arch" type="xml">
            <form string="Extra Cost Details">
                <group>
                    <field name="equipment_name"/>
                    <field name="serial_number"/>
                    <field name="workshop_id"/>
                    <field name="repair_date"/>
                    <field name="extra_price"/>
                    <field name="supporting_documents" widget="many2many_binary" options="{'multi': True}"/>
                </group>
            </form>
        </field>
    </record>

    <!-- Stock Move Line Inherit View (Form) -->
    <record id="view_move_line_form" model="ir.ui.view">
        <field name="name">stock.move.line.form</field>
        <field name="model">stock.move.line</field>
        <field name="inherit_id" ref="stock.view_move_line_form"/>
        <field name="arch" type="xml">
            <xpath expr="//field[@name='reference']" position="after">
                <field name="vehicle_name"/>
            </xpath>
            <xpath expr="//field[@name='create_uid']" position="after">
                <field name="repair_remarks"/>
                <field name="total_cost"/>
            </xpath>
        </field>
    </record>

    <!-- Stock Move Line Inherit View (Tree) -->
    <record id="view_move_line_tree" model="ir.ui.view">
        <field name="name">stock.move.line.tree</field>
        <field name="model">stock.move.line</field>
        <field name="inherit_id" ref="stock.view_move_line_tree"/>
        <field name="arch" type="xml">
            <xpath expr="//field[@name='reference']" position="after">
                <field name="vehicle_name"/>
            </xpath>
            <xpath expr="//field[@name='lot_id']" position="after">
                <field name="repair_remarks"/>
                <field name="warranty_date_lot"/>
            </xpath>
            <xpath expr="//field[@name='quantity']" position="after">
                <field name="total_cost"/>
            </xpath>
        </field>
    </record>

    <!-- Inherit Production Lot View -->
    <record id="inherit_lot_form_view" model="ir.ui.view">
        <field name="name">inherit.lot.form.view</field>
        <field name="model">stock.lot</field>
        <field name="inherit_id" ref="stock.view_production_lot_form"/>
        <field name="arch" type="xml">
            <xpath expr="//field[@name='ref']" position="after">
                <field name="vendor_warranty_date"/>
                <field name="customer_name"/>
            </xpath>
        </field>
    </record>

    <!-- Inherit Stock Move Line Tree View -->
    <record id="inherit_stock_move_line_tree" model="ir.ui.view">
        <field name="name">inherit.stock.move.line.tree</field>
        <field name="model">stock.move.line</field>
        <field name="inherit_id" ref="stock.view_stock_move_line_operation_tree"/>
        <field name="arch" type="xml">
            <xpath expr="//field[@name='lot_name']" position="after">
                <field name="vendor_warranty_date"/>
                <field name="warranty_date_lot"/>
            </xpath>
        </field>
    </record>

    <!-- Subtotal Field Inherit View -->
    <record id="view_repair_order_form_inherit" model="ir.ui.view">
        <field name="name">repair.order.form.subtotal.inherit</field>
        <field name="model">repair.order</field>
        <field name="inherit_id" ref="repair.view_repair_order_form"/>
        <field name="arch" type="xml">
            <xpath expr="//field[@name='move_ids']" position="after">
                <div class="text-center" style="margin-top: 20px;">
                    <h3>
                        <strong><field name="subtotal" string="Subtotal" nolabel="1"/></strong>
                    </h3>
                </div>
            </xpath>
<!--            <xpath expr="//header" position="inside">-->
<!--                <button name="action_set_to_draft" type="object" string="Revoke order"-->
<!--                        class="oe_highlight" invisible="state != 'done'"/>-->
<!--            </xpath>-->
        </field>
    </record>

    <!-- Repairs List Action -->
    <record id="report_stock_move_line_action" model="ir.actions.act_window">
        <field name="name">Repairs List</field>
        <field name="res_model">stock.move.line</field>
        <field name="view_mode">tree,kanban,pivot,form</field>
        <field name="view_id" ref="stock.view_move_line_tree"/>
        <field name="context">{'group_by': 'vehicle_name'}</field>
        <field name="domain">[('vehicle_name', '!=', False)]</field>
    </record>

    <!-- Workshop Master Action -->
    <record id="action_workshop_master" model="ir.actions.act_window">
        <field name="name">Workshop Master</field>
        <field name="res_model">workshop.master</field>
        <field name="view_mode">tree,form</field>
    </record>

    <!-- Repairs List Menu -->
    <menuitem id="report_move_history"
              name="Repairs List"
              action="report_stock_move_line_action"
              parent="repair.repair_menu_reporting"/>
</odoo>
